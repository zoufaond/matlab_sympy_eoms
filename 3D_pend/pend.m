function xd = pend(t, x, g,l,mass, IB, a,b)

IBxx = IB(1);
IByy = IB(2);
IBzz = IB(3);
IBxy = IB(6);
IByz = IB(4);
IBzx = IB(5);
q1 = x(1);
q2 = x(2);
q3 = x(3);
u1 = x(4);
u2 = x(5);
u3 = x(6);

xd = zeros(6,1);
% upevnene ve stredu
% mm = [1, 0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                      0;
%       0, 1, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                      0;
%       0, 0, 1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                                                                                                                                                                                                                                      0;
%       0, 0, 0,                                                                                                                           IBxx*(sin(q2)^2 + sin(q3)^2*cos(q2)^2 + cos(q2)^2*cos(q3)^2)^2 + IByy*(-(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*sin(q3)*cos(q2) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*cos(q2)*cos(q3) - sin(q1)*sin(q2)*cos(q2))^2 + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*cos(q2)*cos(q3) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*sin(q3)*cos(q2) + sin(q2)*cos(q1)*cos(q2))^2 + m*(l^2*sin(q2)^2 + l^2*cos(q2)^2*cos(q3)^2), IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*cos(q3) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*sin(q3))*(-(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*sin(q3)*cos(q2) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*cos(q2)*cos(q3) - sin(q1)*sin(q2)*cos(q2)) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*sin(q3) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*cos(q3))*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*cos(q2)*cos(q3) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*sin(q3)*cos(q2) + sin(q2)*cos(q1)*cos(q2)) + l^2*m*sin(q3)*cos(q2)*cos(q3), IBxx*(sin(q2)^2 + sin(q3)^2*cos(q2)^2 + cos(q2)^2*cos(q3)^2)*sin(q2) - IByy*(-(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*sin(q3)*cos(q2) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*cos(q2)*cos(q3) - sin(q1)*sin(q2)*cos(q2))*sin(q1)*cos(q2) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*cos(q2)*cos(q3) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*sin(q3)*cos(q2) + sin(q2)*cos(q1)*cos(q2))*cos(q1)*cos(q2) + l^2*m*sin(q2);
%       0, 0, 0, IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*cos(q3) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*sin(q3))*(-(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*sin(q3)*cos(q2) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*cos(q2)*cos(q3) - sin(q1)*sin(q2)*cos(q2)) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*sin(q3) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*cos(q3))*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*cos(q2)*cos(q3) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*sin(q3)*cos(q2) + sin(q2)*cos(q1)*cos(q2)) + l^2*m*sin(q3)*cos(q2)*cos(q3),                                                                                                                                                                                                                                                                                                                      IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*cos(q3) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*sin(q3))^2 + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*sin(q3) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*cos(q3))^2 + l^2*m*sin(q3)^2,                                                                                                                                                                                  -IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*cos(q3) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*sin(q3))*sin(q1)*cos(q2) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*sin(q3) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*cos(q3))*cos(q1)*cos(q2);
%       0, 0, 0,                                                                                                                              IBxx*(sin(q2)^2 + sin(q3)^2*cos(q2)^2 + cos(q2)^2*cos(q3)^2)*sin(q2) - IByy*(-(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*sin(q3)*cos(q2) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*cos(q2)*cos(q3) - sin(q1)*sin(q2)*cos(q2))*sin(q1)*cos(q2) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*cos(q2)*cos(q3) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*sin(q3)*cos(q2) + sin(q2)*cos(q1)*cos(q2))*cos(q1)*cos(q2) + l^2*m*sin(q2),                                                                                                                                                                                                                                                                                                               -IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*cos(q3) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*sin(q3))*sin(q1)*cos(q2) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*sin(q3) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*cos(q3))*cos(q1)*cos(q2),                                                                                                                                                                                                                                                                                                                                                                     IBxx*sin(q2)^2 + IByy*sin(q1)^2*cos(q2)^2 + IBzz*cos(q1)^2*cos(q2)^2 + l^2*m];
% 
% fo = [
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   u1;
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   u2;
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   u3;
% -g*l*m*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*sin(q2) - g*l*m*sin(q1)*cos(q2)^2*cos(q3) + l*m*(-l*(u1*sin(q2) + u3)*(-u1*sin(q3)*cos(q2) + u2*cos(q3)) - l*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)))*cos(q2)*cos(q3) - l*m*(-l*(-u1*sin(q3)*cos(q2) + u2*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + l*u1*u2*cos(q2))*sin(q2) - ((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*cos(q2)*cos(q3) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*sin(q3)*cos(q2) + sin(q2)*cos(q1)*cos(q2))*(-IBxx*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IByy*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3)) + u1*u2*cos(q1)*cos(q2)^2) + (IBxx*((-u1*sin(q2) - u3)*sin(q1)*cos(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*(-(-u1*sin(q2) - u3)*sin(q1)*cos(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))))*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3)) + (IByy*((-u1*sin(q2) - u3)*sin(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)) + IBzz*(-(-u1*sin(q2) - u3)*sin(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1)))) - (-(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*sin(q3)*cos(q2) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*cos(q2)*cos(q3) - sin(q1)*sin(q2)*cos(q2))*(IBxx*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3)) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)) - u1*u2*sin(q1)*cos(q2)^2) - IBzz*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + (IBxx*((-u1*sin(q2) - u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))) + IByy*(-(-u1*sin(q2) - u3)*cos(q1)*cos(q2) - (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))))*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3)) + (IByy*((-u1*sin(q2) - u3)*sin(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)) + IBzz*(-(-u1*sin(q2) - u3)*sin(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3)))) - (sin(q2)^2 + sin(q3)^2*cos(q2)^2 + cos(q2)^2*cos(q3)^2)*(IBxx*(-(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3))*sin(q3)*cos(q2) + (-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3))*cos(q2)*cos(q3) + u1*u2*sin(q2)*cos(q2)) - IByy*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1)))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + IBzz*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1)))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + (IBxx*((-u1*sin(q2) - u3)*sin(q1)*cos(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*(-(-u1*sin(q2) - u3)*sin(q1)*cos(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + (IBxx*((-u1*sin(q2) - u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))) + IByy*(-(-u1*sin(q2) - u3)*cos(q1)*cos(q2) - (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))));
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         -g*l*m*sin(q1)*sin(q3)*cos(q2) + l*m*(-l*(u1*sin(q2) + u3)*(-u1*sin(q3)*cos(q2) + u2*cos(q3)) - l*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)))*sin(q3) - ((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*sin(q3) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*cos(q3))*(-IBxx*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IByy*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3)) + u1*u2*cos(q1)*cos(q2)^2) + (IBxx*((-u1*sin(q2) - u3)*sin(q1)*cos(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*(-(-u1*sin(q2) - u3)*sin(q1)*cos(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))))*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3)) + (IByy*((-u1*sin(q2) - u3)*sin(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)) + IBzz*(-(-u1*sin(q2) - u3)*sin(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1)))) - ((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*cos(q3) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*sin(q3))*(IBxx*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3)) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)) - u1*u2*sin(q1)*cos(q2)^2) - IBzz*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + (IBxx*((-u1*sin(q2) - u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))) + IByy*(-(-u1*sin(q2) - u3)*cos(q1)*cos(q2) - (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))))*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3)) + (IByy*((-u1*sin(q2) - u3)*sin(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)) + IBzz*(-(-u1*sin(q2) - u3)*sin(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))));
%                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -g*l*m*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1)) - l*m*(-l*(-u1*sin(q3)*cos(q2) + u2*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + l*u1*u2*cos(q2)) - (IBxx*(-(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3))*sin(q3)*cos(q2) + (-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3))*cos(q2)*cos(q3) + u1*u2*sin(q2)*cos(q2)) - IByy*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1)))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + IBzz*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1)))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + (IBxx*((-u1*sin(q2) - u3)*sin(q1)*cos(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*(-(-u1*sin(q2) - u3)*sin(q1)*cos(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + (IBxx*((-u1*sin(q2) - u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))) + IByy*(-(-u1*sin(q2) - u3)*cos(q1)*cos(q2) - (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))))*sin(q2) - (-IBxx*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IByy*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*((sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3)) + u1*u2*cos(q1)*cos(q2)^2) + (IBxx*((-u1*sin(q2) - u3)*sin(q1)*cos(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))) + IBzz*(-(-u1*sin(q2) - u3)*sin(q1)*cos(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))))*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3)) + (IByy*((-u1*sin(q2) - u3)*sin(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)) + IBzz*(-(-u1*sin(q2) - u3)*sin(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)))*(-(u1*sin(q2) + u3)*sin(q1)*cos(q2) + (-u1*sin(q3)*cos(q2) + u2*cos(q3))*(-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3)) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*(sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))))*cos(q1)*cos(q2) + (IBxx*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + IByy*((-sin(q1)*sin(q2)*sin(q3) + cos(q1)*cos(q3))*(u1*u2*sin(q2)*sin(q3) - u1*u3*cos(q2)*cos(q3) - u2*u3*sin(q3)) + (sin(q1)*sin(q2)*cos(q3) + sin(q3)*cos(q1))*(-u1*u2*sin(q2)*cos(q3) - u1*u3*sin(q3)*cos(q2) + u2*u3*cos(q3)) - u1*u2*sin(q1)*cos(q2)^2) - IBzz*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))) + (IBxx*((-u1*sin(q2) - u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))) + IByy*(-(-u1*sin(q2) - u3)*cos(q1)*cos(q2) - (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(-u1*cos(q2)*cos(q3) - u2*sin(q3)) - (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(u1*sin(q3)*cos(q2) - u2*cos(q3))))*((u1*sin(q2) + u3)*sin(q2) - (-u1*sin(q3)*cos(q2) + u2*cos(q3))*sin(q3)*cos(q2) + (u1*cos(q2)*cos(q3) + u2*sin(q3))*cos(q2)*cos(q3)) + (IByy*((-u1*sin(q2) - u3)*sin(q2) - (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) + (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)) + IBzz*(-(-u1*sin(q2) - u3)*sin(q2) + (u1*sin(q3)*cos(q2) - u2*cos(q3))*sin(q3)*cos(q2) - (-u1*cos(q2)*cos(q3) - u2*sin(q3))*cos(q2)*cos(q3)))*((u1*sin(q2) + u3)*cos(q1)*cos(q2) + (sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + (sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1))*(-u1*sin(q3)*cos(q2) + u2*cos(q3))))*sin(q1)*cos(q2)];
% 

%% upevnene jeste ve smeru x o a
mm = [
1, 0, 0,                                                                                                                                                                                                                            0,                                                                                                                                                                                                                            0,                                                                                           0;
0, 1, 0,                                                                                                                                                                                                                            0,                                                                                                                                                                                                                            0,                                                                                           0;
0, 0, 1,                                                                                                                                                                                                                            0,                                                                                                                                                                                                                            0,                                                                                           0;
0, 0, 0,                           IBxx*cos(q2)^2*cos(q3)^2 + IByy*sin(q3)^2*cos(q2)^2 + IBzz*sin(q2)^2 + mass*((a*sin(q2) - l*cos(q2)*cos(q3))^2 + (a*sin(q3) + b*cos(q3))^2*cos(q2)^2 + (b*sin(q2) + l*sin(q3)*cos(q2))^2), IBxx*sin(q3)*cos(q2)*cos(q3) - IByy*sin(q3)*cos(q2)*cos(q3) - mass*(l*(a*sin(q2) - l*cos(q2)*cos(q3))*sin(q3) + l*(b*sin(q2) + l*sin(q3)*cos(q2))*cos(q3) + (a*cos(q3) - b*sin(q3))*(a*sin(q3)*cos(q2) + b*cos(q2)*cos(q3))), IBzz*sin(q2) + mass*(a*(a*sin(q2) - l*cos(q2)*cos(q3)) + b*(b*sin(q2) + l*sin(q3)*cos(q2)));
0, 0, 0, IBxx*sin(q3)*cos(q2)*cos(q3) - IByy*sin(q3)*cos(q2)*cos(q3) - mass*(l*(a*sin(q2) - l*cos(q2)*cos(q3))*sin(q3) + l*(b*sin(q2) + l*sin(q3)*cos(q2))*cos(q3) + (a*cos(q3) - b*sin(q3))*(a*sin(q3)*cos(q2) + b*cos(q2)*cos(q3))),                                                                                                        IBxx*sin(q3)^2 + IByy*cos(q3)^2 + mass*(a^2*cos(2*q3) + a^2 - 2*a*b*sin(2*q3) - b^2*cos(2*q3) + b^2 + 2*l^2)/2,                                                             -l*mass*(a*sin(q3) + b*cos(q3));
0, 0, 0,                                                                                                                                  IBzz*sin(q2) + mass*(a*(a*sin(q2) - l*cos(q2)*cos(q3)) + b*(b*sin(q2) + l*sin(q3)*cos(q2))),                                                                                                                                                                                              -l*mass*(a*sin(q3) + b*cos(q3)),                                                                   IBzz + mass*(a^2 + b^2)];


fo = [
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       u1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       u2;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       u3;
2*IBxx*u1*u2*sin(q2)*cos(q2)*cos(q3)^2 + 2*IBxx*u1*u3*sin(q3)*cos(q2)^2*cos(q3) + IBxx*u2^2*sin(q2)*sin(q3)*cos(q3) - 2*IBxx*u2*u3*cos(q2)*cos(q3)^2 + IBxx*u2*u3*cos(q2) - 2*IByy*u1*u2*sin(q2)*cos(q2)*cos(q3)^2 + 2*IByy*u1*u2*sin(q2)*cos(q2) - 2*IByy*u1*u3*sin(q3)*cos(q2)^2*cos(q3) - IByy*u2^2*sin(q2)*sin(q3)*cos(q3) + 2*IByy*u2*u3*cos(q2)*cos(q3)^2 - IByy*u2*u3*cos(q2) - 2*IBzz*u1*u2*sin(q2)*cos(q2) - IBzz*u2*u3*cos(q2) - 2*a^2*mass*u1*u2*sin(q2)*cos(q2)*cos(q3)^2 - 2*a^2*mass*u1*u3*sin(q3)*cos(q2)^2*cos(q3) - a^2*mass*u2^2*sin(q2)*sin(q3)*cos(q3) + 2*a^2*mass*u2*u3*cos(q2)*cos(q3)^2 - 2*a^2*mass*u2*u3*cos(q2) + 4*a*b*mass*u1*u2*sin(q2)*sin(q3)*cos(q2)*cos(q3) - 4*a*b*mass*u1*u3*cos(q2)^2*cos(q3)^2 + 2*a*b*mass*u1*u3*cos(q2)^2 - 2*a*b*mass*u2^2*sin(q2)*cos(q3)^2 + a*b*mass*u2^2*sin(q2) - 4*a*b*mass*u2*u3*sin(q3)*cos(q2)*cos(q3) + a*g*mass*sin(q1)*sin(q2)*cos(q3) + a*g*mass*sin(q3)*cos(q1) + 4*a*l*mass*u1*u2*cos(q2)^2*cos(q3) - 2*a*l*mass*u1*u2*cos(q3) - 2*a*l*mass*u1*u3*sin(q2)*sin(q3)*cos(q2) + a*l*mass*u2^2*sin(q3)*cos(q2) - a*l*mass*u3^2*sin(q3)*cos(q2) + 2*b^2*mass*u1*u2*sin(q2)*cos(q2)*cos(q3)^2 - 2*b^2*mass*u1*u2*sin(q2)*cos(q2) + 2*b^2*mass*u1*u3*sin(q3)*cos(q2)^2*cos(q3) + b^2*mass*u2^2*sin(q2)*sin(q3)*cos(q3) - 2*b^2*mass*u2*u3*cos(q2)*cos(q3)^2 - b*g*mass*sin(q1)*sin(q2)*sin(q3) + b*g*mass*cos(q1)*cos(q3) - 4*b*l*mass*u1*u2*sin(q3)*cos(q2)^2 + 2*b*l*mass*u1*u2*sin(q3) - 2*b*l*mass*u1*u3*sin(q2)*cos(q2)*cos(q3) + b*l*mass*u2^2*cos(q2)*cos(q3) - b*l*mass*u3^2*cos(q2)*cos(q3) - g*l*mass*sin(q1)*cos(q2) + 2*l^2*mass*u1*u2*sin(q2)*cos(q2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           IBxx*u1^2*sin(q2)*sin(q3)^2*cos(q2) - IBxx*u1^2*sin(q2)*cos(q2) + 2*IBxx*u1*u3*sin(q3)^2*cos(q2) - IBxx*u1*u3*cos(q2) - 2*IBxx*u2*u3*sin(q3)*cos(q3) - IByy*u1^2*sin(q2)*sin(q3)^2*cos(q2) - 2*IByy*u1*u3*sin(q3)^2*cos(q2) + IByy*u1*u3*cos(q2) + 2*IByy*u2*u3*sin(q3)*cos(q3) + IBzz*u1^2*sin(q2)*cos(q2) + IBzz*u1*u3*cos(q2) - a^2*mass*u1^2*sin(q2)*sin(q3)^2*cos(q2) + a^2*mass*u1^2*sin(q2)*cos(q2) - 2*a^2*mass*u1*u3*sin(q3)^2*cos(q2) + 2*a^2*mass*u1*u3*cos(q2) + 2*a^2*mass*u2*u3*sin(q3)*cos(q3) - 2*a*b*mass*u1^2*sin(q2)*sin(q3)*cos(q2)*cos(q3) - 4*a*b*mass*u1*u3*sin(q3)*cos(q2)*cos(q3) - 4*a*b*mass*u2*u3*sin(q3)^2 + 2*a*b*mass*u2*u3 - a*g*mass*cos(q1)*cos(q2)*cos(q3) + 2*a*l*mass*u1^2*sin(q2)^2*cos(q3) - a*l*mass*u1^2*cos(q3) + 2*a*l*mass*u1*u3*sin(q2)*cos(q3) + a*l*mass*u3^2*cos(q3) + b^2*mass*u1^2*sin(q2)*sin(q3)^2*cos(q2) + 2*b^2*mass*u1*u3*sin(q3)^2*cos(q2) - 2*b^2*mass*u2*u3*sin(q3)*cos(q3) + b*g*mass*sin(q3)*cos(q1)*cos(q2) - 2*b*l*mass*u1^2*sin(q2)^2*sin(q3) + b*l*mass*u1^2*sin(q3) - 2*b*l*mass*u1*u3*sin(q2)*sin(q3) - b*l*mass*u3^2*sin(q3) - g*l*mass*sin(q2)*cos(q1) - l^2*mass*u1^2*sin(q2)*cos(q2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   -IBxx*(u1*sin(q3)*cos(q2) - u2*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) + IByy*(u1*sin(q3)*cos(q2) - u2*cos(q3))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) - IBzz*u1*u2*cos(q2) + a*g*mass*(sin(q1)*cos(q3) + sin(q2)*sin(q3)*cos(q1)) - a*mass*(a*u1*u2*cos(q2) + l*(u1*u2*sin(q2)*cos(q3) + u1*u3*sin(q3)*cos(q2) - u2*u3*cos(q3)) - (a*(u1*sin(q3)*cos(q2) - u2*cos(q3)) + b*(u1*cos(q2)*cos(q3) + u2*sin(q3)))*(u1*cos(q2)*cos(q3) + u2*sin(q3)) - (b*(u1*sin(q2) + u3) + l*(u1*sin(q3)*cos(q2) - u2*cos(q3)))*(u1*sin(q2) + u3)) - b*g*mass*(sin(q1)*sin(q3) - sin(q2)*cos(q1)*cos(q3)) - b*mass*(b*u1*u2*cos(q2) + l*(-u1*u2*sin(q2)*sin(q3) + u1*u3*cos(q2)*cos(q3) + u2*u3*sin(q3)) + (a*(u1*sin(q2) + u3) - l*(u1*cos(q2)*cos(q3) + u2*sin(q3)))*(u1*sin(q2) + u3) + (a*(u1*sin(q3)*cos(q2) - u2*cos(q3)) + b*(u1*cos(q2)*cos(q3) + u2*sin(q3)))*(u1*sin(q3)*cos(q2) - u2*cos(q3)))];

R = mm\fo;
xd(1) = R(1);
xd(2) = R(2);
xd(3) = R(3);
xd(4) = R(4);
xd(5) = R(5);
xd(6) = R(6);